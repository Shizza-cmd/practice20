# Система управления продажей обуви - ООО «Обувь»

Веб-приложение для управления продажей обуви с различными ролями пользователей, разработанное в рамках демонстрационного экзамена.

## Описание проекта

Система состоит из четырех модулей:

### Модуль 1: Разработка базы данных
- Создана база данных SQLite в 3-й нормальной форме
- Обеспечена ссылочная целостность
- Созданы скрипты миграции и импорта данных
- ER-диаграмма представлена в SQL скрипте

### Модуль 2: Разработка алгоритма и создание приложения
- Реализована система авторизации с ролями
- Создан интерфейс просмотра товаров с условным форматированием
- Реализованы все требования по отображению данных

### Модуль 3: Разработка последовательного пользовательского интерфейса
- Реализована навигация между окнами
- Добавлены формы добавления/редактирования товаров
- Реализованы поиск, фильтрация и сортировка в реальном времени
- Добавлена обработка исключительных ситуаций

### Модуль 4: Добавление функционала работы с заказами
- Реализован просмотр заказов для менеджера и администратора
- Добавлены формы CRUD для заказов (только для администратора)

## Структура проекта

```
20pract/
├── app/                          # Основное приложение
│   ├── __init__.py
│   ├── main.py                   # Точка входа приложения
│   ├── database.py              # Настройка подключения к БД
│   ├── models.py                 # SQLAlchemy модели (Модуль 1)
│   ├── schemas.py                # Pydantic схемы для валидации
│   ├── routers/                  # Роутеры (контроллеры)
│   │   ├── auth.py              # Авторизация (Модуль 2)
│   │   ├── products.py          # Товары (Модули 2, 3)
│   │   └── orders.py             # Заказы (Модуль 4)
│   ├── services/                 # Бизнес-логика
│   │   ├── auth_service.py      # Сервис авторизации
│   │   ├── product_service.py   # Сервис товаров
│   │   └── order_service.py      # Сервис заказов
│   ├── templates/                # HTML шаблоны (Модули 2, 3, 4)
│   │   ├── base.html            # Базовый шаблон
│   │   ├── login.html           # Страница входа (Модуль 2)
│   │   ├── products.html        # Список товаров (Модули 2, 3)
│   │   ├── product_form.html     # Форма товара (Модуль 3)
│   │   ├── orders.html          # Список заказов (Модуль 4)
│   │   └── order_form.html       # Форма заказа (Модуль 4)
│   └── static/                   # Статические файлы
│       ├── css/
│       │   └── style.css        # Стили по руководству
│       ├── js/
│       │   └── main.js          # JavaScript для интерактивности
│       └── images/               # Изображения и ресурсы
│           ├── Icon.png         # Логотип компании
│           ├── picture.png      # Заглушка для товаров
│           └── products/        # Изображения товаров
├── migrations/                   # Скрипты миграции БД (Модуль 1)
│   ├── init_db.py               # Инициализация БД
│   ├── import_data.py           # Импорт из CSV
│   ├── import_excel.py          # Импорт из Excel (Модуль 1)
│   └── create_db_script.sql     # SQL скрипт создания БД
├── resources/                    # Ресурсы проекта
│   └── import_data/             # Файлы для импорта
├── pril/                         # Исходные данные (Модуль 1)
│   ├── Icon.png, Icon.JPG       # Логотип компании
│   ├── picture.png              # Заглушка
│   ├── 1.jpg - 10.jpg          # Изображения товаров
│   ├── Tovar.xlsx              # Данные товаров
│   ├── user_import.xlsx        # Данные пользователей
│   └── Заказ_import.xlsx       # Данные заказов
├── tests/                        # Тесты
├── requirements.txt             # Зависимости Python
├── run.py                       # Скрипт запуска
├── create_image_placeholder.py  # Создание заглушки
├── README.md                    # Этот файл
├── INSTALL.md                   # Инструкция по установке
├── START.md                     # Быстрый старт
└── IMPORT_DATA.md               # Инструкция по импорту
```

## Как работают все три приложения вместе

### 1. Приложение базы данных (Модуль 1)

**Файлы:**
- `app/models.py` - определяет структуру БД (таблицы, связи)
- `app/database.py` - настраивает подключение к SQLite
- `migrations/init_db.py` - создает таблицы и начальные данные
- `migrations/import_excel.py` - импортирует данные из Excel

**Как работает:**
1. При первом запуске `app/main.py` автоматически создает таблицы через `Base.metadata.create_all()`
2. Скрипт `init_db.py` заполняет БД начальными данными (пользователи, категории, производители, поставщики)
3. Скрипт `import_excel.py` импортирует данные из файлов в папке `pril/`
4. Все модели связаны внешними ключами для обеспечения целостности данных

### 2. Приложение веб-интерфейса (Модули 2, 3, 4)

**Файлы:**
- `app/main.py` - точка входа, настраивает FastAPI приложение
- `app/routers/` - обработчики HTTP запросов
- `app/templates/` - HTML шаблоны для отображения
- `app/static/` - CSS и JavaScript для стилизации и интерактивности

**Как работает:**
1. `main.py` создает FastAPI приложение и подключает роутеры
2. Роутеры обрабатывают запросы и используют сервисы для работы с БД
3. Сервисы (`app/services/`) содержат бизнес-логику и обращаются к моделям
4. Шаблоны рендерятся с данными из БД и отображаются пользователю
5. Статические файлы (CSS/JS) обеспечивают стилизацию и интерактивность

**Поток данных:**
```
Запрос → Роутер → Сервис → Модель (БД) → Сервис → Роутер → Шаблон → HTML ответ
```

### 3. Приложение импорта данных (Модуль 1)

**Файлы:**
- `migrations/import_excel.py` - читает Excel файлы и загружает в БД
- `migrations/import_data.py` - альтернативный импорт из CSV

**Как работает:**
1. Читает Excel файлы из папки `pril/`
2. Парсит данные с помощью pandas
3. Создает или находит связанные записи (категории, производители, поставщики)
4. Создает записи товаров и заказов в БД
5. Копирует изображения товаров в нужные папки

**Интеграция:**
- Использует те же модели (`app/models.py`), что и основное приложение
- Использует те же сервисы (`app/services/auth_service.py`) для хеширования паролей
- Результаты импорта сразу доступны в веб-интерфейсе

## Взаимосвязь компонентов

```
┌─────────────────────────────────────────────────────────────┐
│                    База данных (SQLite)                      │
│  ┌──────────┐  ┌──────────┐  ┌──────────┐  ┌──────────┐ │
│  │  Users   │  │ Products │  │  Orders  │  │ Categories│ │
│  └──────────┘  └──────────┘  └──────────┘  └──────────┘ │
└─────────────────────────────────────────────────────────────┘
         ▲                ▲                ▲
         │                │                │
    ┌────┴────┐      ┌────┴────┐      ┌────┴────┐
    │ Models  │      │Services │      │Routers  │
    │(models) │◄─────│(services)│◄─────│(routers)│
    └─────────┘      └─────────┘      └─────────┘
         ▲                ▲                │
         │                │                │
    ┌────┴────────────────┴────────────────┴────┐
    │         FastAPI Application (main.py)      │
    └────────────────────────────────────────────┘
         │                │                │
    ┌────┴────┐      ┌────┴────┐      ┌────┴────┐
    │Templates │      │  CSS    │      │   JS    │
    │(HTML)    │      │(styles) │      │(scripts)│
    └──────────┘      └─────────┘      └─────────┘
```

## Установка и запуск

### Быстрая установка:

1. **Установите зависимости:**
```bash
pip install -r requirements.txt
```

2. **Инициализируйте базу данных:**
```bash
python migrations\init_db.py
```

3. **Импортируйте данные из Excel (опционально):**
```bash
python migrations\import_excel.py
```

4. **Запустите приложение:**
```bash
python run.py
```

5. **Откройте в браузере:**
http://localhost:8000

Подробные инструкции см. в файлах:
- `INSTALL.md` - полная инструкция по установке
- `START.md` - быстрый старт
- `IMPORT_DATA.md` - импорт данных

## Учетные записи

- **Администратор**: `admin` / `admin123`
- **Менеджер**: `manager` / `manager123`
- **Клиент**: `client` / `client123`

Или войдите как **гость**, нажав "Просмотр как гость" на странице входа.

## Роли и права доступа

### Гость
- Просмотр товаров (без фильтрации, сортировки, поиска)

### Клиент
- Просмотр товаров (без фильтрации, сортировки, поиска)

### Менеджер
- Просмотр товаров (с фильтрацией, сортировкой, поиском)
- Просмотр заказов

### Администратор
- Все возможности менеджера
- Добавление/редактирование/удаление товаров
- Добавление/редактирование/удаление заказов

## Особенности реализации

### Модуль 1 (БД):
- ✅ 3-я нормальная форма
- ✅ Ссылочная целостность через внешние ключи
- ✅ Индексы для оптимизации запросов
- ✅ Скрипты миграции и импорта

### Модуль 2 (Приложение):
- ✅ Система авторизации с сессиями
- ✅ Условное форматирование товаров:
  - Скидка > 15% → зеленый фон (#2E8B57)
  - Товар со скидкой → перечеркнутая цена красным
  - Нет на складе → голубой фон
- ✅ Отображение всех полей товара согласно макету

### Модуль 3 (UI):
- ✅ Навигация между страницами (кнопка "Назад")
- ✅ Поиск в реальном времени по всем текстовым полям
- ✅ Фильтрация по поставщику
- ✅ Сортировка по количеству на складе
- ✅ Форма добавления/редактирования товаров
- ✅ Загрузка и обработка изображений (300x200px)
- ✅ Валидация данных
- ✅ Обработка ошибок с информативными сообщениями
- ✅ Предотвращение открытия нескольких окон редактирования

### Модуль 4 (Заказы):
- ✅ Просмотр заказов для менеджера и администратора
- ✅ Форма добавления/редактирования заказов (только администратор)
- ✅ Удаление заказов (только администратор)
- ✅ Отображение всех полей согласно макету

## Руководство по стилю

Приложение соответствует руководству по стилю:
- **Основной фон**: #FFFFFF (белый)
- **Дополнительный фон**: #7FFF00 (header, footer, фильтры)
- **Акцентирование внимания**: #00FA9A (кнопки, hover)
- **Шрифт**: Times New Roman
- **Логотип**: Icon.png из ресурсов
- **Название**: ООО «Обувь»

## Технологии

- **Backend**: FastAPI (Python)
- **База данных**: SQLite (легко переносится на PostgreSQL)
- **ORM**: SQLAlchemy 2.0
- **Валидация**: Pydantic v2
- **Frontend**: HTML, CSS, JavaScript
- **Шаблоны**: Jinja2
- **Импорт данных**: pandas, openpyxl

## Разработка

Для разработки рекомендуется использовать виртуальное окружение:
```bash
python -m venv .venv
.venv\Scripts\activate  # Windows
pip install -r requirements.txt
```

## Лицензия

Проект разработан в рамках демонстрационного экзамена.
